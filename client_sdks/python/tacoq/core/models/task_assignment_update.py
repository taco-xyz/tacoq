from datetime import datetime
from uuid import UUID

from pydantic import Field

from tacoq.core.models.avro_serializable_base_model import (
    AvroSerializableBaseModel,
    avro_schema_path,
)
from tacoq.core.models.task import TaskRawInput


@avro_schema_path("schemas/avro/task_assignment_update.json")
class TaskAssignmentUpdate(AvroSerializableBaseModel):
    """Update of a task being assigned to a worker."""

    task_kind: str
    """ The kind of the task - dictates which function the worker will execute 
    to handle it."""

    worker_kind: str
    """ The kind of worker that will execute the task. Dictates the queue that 
    the task will be routed through. """

    input_data: TaskRawInput
    """ The input data of the task."""

    priority: int
    """ The priority of the task, ranging from 0 (lowest) to 255 (highest). """

    ttl_duration: int
    """ The duration of how long the task should live after it has been completed."""

    created_at: datetime
    """ The time the task was created at. """

    otel_ctx_carrier: dict[str, str]
    """ The OpenTelemetry context carrier for the task. """

    id: UUID
    """The unique ID of the task. Generated by the client so that it can be 
    communicated to the relay and the workers directly."""

    update_type: str = Field(default="Assignment")
    """ The type of update. """
